<!DOCTYPE html>
<html>
<head>
    <title>Visual Network Map - Roodan</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: system-ui, 'Segoe UI', Inter, sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            overflow: hidden;
        }
        
        .header {
            background: #020617;
            border-bottom: 1px solid #1e293b;
            padding: 15px 25px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats {
            display: flex;
            gap: 15px;
        }
        
        .stat {
            background: rgba(255,255,255,0.05);
            border: 1px solid #1e293b;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
        }
        
        .stat-value {
            color: #D71920;
            font-weight: bold;
            font-size: 14px;
        }
        
        .container {
            display: flex;
            height: 100vh;
            padding-top: 70px;
        }
        
        .visualization {
            flex: 1;
            background: #020617;
            position: relative;
            overflow: hidden;
        }
        
        #network-graph {
            width: 100%;
            height: 100%;
        }
        
        .sidebar {
            width: 300px;
            background: #020617;
            border-left: 1px solid #1e293b;
            padding: 20px;
            overflow-y: auto;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #e5e7eb;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .device-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .device-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid #1e293b;
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .device-item:hover {
            border-color: #D71920;
            background: rgba(215, 25, 32, 0.1);
        }
        
        .device-item.active {
            border-color: #D71920;
            background: rgba(215, 25, 32, 0.2);
        }
        
        .device-name {
            font-weight: bold;
            font-size: 14px;
            color: #e5e7eb;
        }
        
        .device-ip {
            font-family: monospace;
            font-size: 11px;
            color: #94a3b8;
            margin-top: 2px;
        }
        
        .device-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .status-online { background: rgba(16, 185, 129, 0.2); color: #10B981; }
        .status-unreachable { background: rgba(239, 68, 68, 0.2); color: #EF4444; }
        
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #020617;
            border: 1px solid #1e293b;
            color: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .control-btn:hover {
            border-color: #D71920;
            background: rgba(215, 25, 32, 0.1);
            transform: scale(1.1);
        }
        
        .legend {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(2, 6, 23, 0.9);
            border: 1px solid #1e293b;
            border-radius: 10px;
            padding: 15px;
            font-size: 12px;
            z-index: 100;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .node-tooltip {
            position: absolute;
            background: rgba(2, 6, 23, 0.95);
            border: 1px solid #D71920;
            border-radius: 8px;
            padding: 15px;
            pointer-events: none;
            font-size: 12px;
            max-width: 300px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }
        
        .tooltip-title {
            font-weight: bold;
            color: #D71920;
            margin-bottom: 5px;
        }
        
        .tooltip-detail {
            margin-bottom: 3px;
            color: #94a3b8;
        }
        
        .connection-label {
            font-size: 10px;
            font-family: monospace;
            fill: #94a3b8;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#D71920" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="16"/>
                <line x1="8" y1="12" x2="16" y2="12"/>
            </svg>
            Visual Network Topology
        </h1>
        <div class="stats">
            <div class="stat">
                <div class="stat-value">9</div>
                <div>Devices</div>
            </div>
            <div class="stat">
                <div class="stat-value">8</div>
                <div>Connections</div>
            </div>
            <div class="stat">
                <div class="stat-value">8</div>
                <div>Online</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="visualization">
            <svg id="network-graph"></svg>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #D71920;"></div>
                    <span>Switch</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196F3;"></div>
                    <span>Router</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF9800;"></div>
                    <span>MikroTik</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #10B981;"></div>
                    <span>Online</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #EF4444;"></div>
                    <span>Offline</span>
                </div>
            </div>
            
            <div class="controls">
                <button class="control-btn" onclick="zoomIn()" title="Zoom In">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        <line x1="11" y1="8" x2="11" y2="14"/>
                        <line x1="8" y1="11" x2="14" y2="11"/>
                    </svg>
                </button>
                <button class="control-btn" onclick="zoomOut()" title="Zoom Out">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        <line x1="8" y1="11" x2="14" y2="11"/>
                    </svg>
                </button>
                <button class="control-btn" onclick="resetView()" title="Reset View">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                    </svg>
                </button>
                <button class="control-btn" onclick="fitToScreen()" title="Fit to Screen">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/>
                    </svg>
                </button>
            </div>
            
            <div class="node-tooltip" id="node-tooltip"></div>
        </div>
        
        <div class="sidebar">
            <div class="sidebar-title">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <line x1="9" y1="3" x2="9" y2="21"/>
                </svg>
                Network Devices
            </div>
            
            <div class="device-list" id="device-list">
                <!-- Devices will be populated by JavaScript -->
            </div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #1e293b;">
                <div style="font-size: 12px; color: #94a3b8; margin-bottom: 10px;">
                    <strong>Instructions:</strong>
                </div>
                <div style="font-size: 11px; color: #64748b; line-height: 1.5;">
                    • Click and drag nodes to rearrange<br>
                    • Hover over nodes for details<br>
                    • Click devices in sidebar to highlight<br>
                    • Use controls to zoom/pan
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Network data
        const devices = [
  {
    "id": "dev_5beecadf",
    "site": "Roodan",
    "name": "Device-10.192.178.2",
    "ip": "10.192.178.2",
    "type": "unknown",
    "model": "",
    "platform": "cisco WS-C2960S-48FPS-L",
    "capabilities": "",
    "discovered_by": "cdp_discovery",
    "discovered_at": "2025-12-14T16:56:19.419260",
    "last_seen": "2025-12-16T11:58:30.409851",
    "last_modified": "2025-12-14T16:56:19.419360",
    "status": "unreachable",
    "reachable": false,
    "config_backup": {
      "enabled": false
    },
    "connections": [
      {
        "id": "conn_0a8845ec",
        "local_interface": "GigabitEthernet1/0/42",
        "remote_device": "dev_cc3a85f4",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T16:56:19.419870",
        "status": "up"
      },
      {
        "id": "conn_62bec038",
        "local_interface": "GigabitEthernet1/0/40",
        "remote_device": "dev_683fb499",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T16:56:19.420482",
        "status": "up"
      },
      {
        "id": "conn_502b24b6",
        "local_interface": "GigabitEthernet1/0/47",
        "remote_device": "dev_385652c8",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T16:56:19.421537",
        "status": "up"
      },
      {
        "id": "conn_6ceed9b1",
        "local_interface": "GigabitEthernet1/0/39",
        "remote_device": "dev_5f5a1277",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T16:56:19.421876",
        "status": "up"
      },
      {
        "id": "conn_848f7f2d",
        "local_interface": "GigabitEthernet1/0/42",
        "remote_device": "dev_cc3a85f4",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:04:20.346334",
        "status": "up"
      },
      {
        "id": "conn_3aaf5186",
        "local_interface": "GigabitEthernet1/0/40",
        "remote_device": "dev_683fb499",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:04:20.346390",
        "status": "up"
      },
      {
        "id": "conn_7d2522d0",
        "local_interface": "GigabitEthernet1/0/47",
        "remote_device": "dev_385652c8",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:04:20.346474",
        "status": "up"
      },
      {
        "id": "conn_b610950f",
        "local_interface": "GigabitEthernet1/0/39",
        "remote_device": "dev_5f5a1277",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:04:20.346510",
        "status": "up"
      },
      {
        "id": "conn_ce20bcef",
        "local_interface": "GigabitEthernet1/0/42",
        "remote_device": "dev_cc3a85f4",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:06:06.209262",
        "status": "up"
      },
      {
        "id": "conn_9b4801b0",
        "local_interface": "GigabitEthernet1/0/40",
        "remote_device": "dev_683fb499",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:06:06.209445",
        "status": "up"
      },
      {
        "id": "conn_4ea42909",
        "local_interface": "GigabitEthernet1/0/47",
        "remote_device": "dev_385652c8",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:06:06.209728",
        "status": "up"
      },
      {
        "id": "conn_00352764",
        "local_interface": "GigabitEthernet1/0/39",
        "remote_device": "dev_5f5a1277",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:06:06.209854",
        "status": "up"
      },
      {
        "id": "conn_2216d279",
        "local_interface": "GigabitEthernet1/0/42",
        "remote_device": "dev_cc3a85f4",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-15T12:18:13.084370",
        "status": "up"
      },
      {
        "id": "conn_748cc432",
        "local_interface": "GigabitEthernet1/0/40",
        "remote_device": "dev_683fb499",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-15T12:18:13.084464",
        "status": "up"
      },
      {
        "id": "conn_fab2ce2e",
        "local_interface": "GigabitEthernet1/0/47",
        "remote_device": "dev_385652c8",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-15T12:18:13.084616",
        "status": "up"
      },
      {
        "id": "conn_1894e2da",
        "local_interface": "GigabitEthernet1/0/39",
        "remote_device": "dev_5f5a1277",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-15T12:18:13.084681",
        "status": "up"
      }
    ],
    "credentials_used": "kordestani",
    "modules_successful": [
      "cdp_discovery"
    ],
    "modules_failed": [],
    "locked": false,
    "notes": "Discovered via CDP from 10.192.178.4"
  },
  {
    "id": "dev_cc3a85f4",
    "site": "Roodan",
    "name": "RW-Bandar.OKCO.ir",
    "ip": "10.192.178.1",
    "type": "unknown",
    "model": "",
    "platform": "Cisco CISCO2911/K9",
    "capabilities": null,
    "discovered_by": "cdp_discovery",
    "discovered_at": "2025-12-14T16:56:19.419773",
    "last_seen": "2025-12-15T12:24:20.599052",
    "last_modified": "2025-12-14T16:56:19.419802",
    "status": "online",
    "reachable": true,
    "config_backup": {
      "enabled": false
    },
    "connections": [],
    "credentials_used": "kordestani",
    "modules_successful": [
      "cdp_discovery"
    ],
    "modules_failed": [],
    "locked": false,
    "notes": "Discovered via CDP from 10.192.178.2"
  },
  {
    "id": "dev_683fb499",
    "site": "Roodan",
    "name": "Sw4-Dry-BalayeEdari.OKCO.ir",
    "ip": "10.192.178.4",
    "type": "unknown",
    "model": "",
    "platform": "cisco WS-C2960S-48FPS-L",
    "capabilities": null,
    "discovered_by": "cdp_discovery",
    "discovered_at": "2025-12-14T16:56:19.420251",
    "last_seen": "2025-12-15T12:24:20.599100",
    "last_modified": "2025-12-14T16:56:19.420330",
    "status": "online",
    "reachable": true,
    "config_backup": {
      "enabled": false
    },
    "connections": [
      {
        "id": "conn_3201dda8",
        "local_interface": "GigabitEthernet1/0/48",
        "remote_device": "dev_5beecadf",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:05:24.402301",
        "status": "up"
      },
      {
        "id": "conn_74c7acc3",
        "local_interface": "GigabitEthernet1/0/46",
        "remote_device": "dev_b1d768a2",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:05:24.402454",
        "status": "up"
      },
      {
        "id": "conn_22aded47",
        "local_interface": "GigabitEthernet1/0/46",
        "remote_device": "dev_1b4e5150",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-14T17:05:24.402580",
        "status": "up"
      }
    ],
    "credentials_used": "kordestani",
    "modules_successful": [
      "cdp_discovery"
    ],
    "modules_failed": [],
    "locked": false,
    "notes": "Discovered via CDP from 10.192.178.2"
  },
  {
    "id": "dev_385652c8",
    "site": "Roodan",
    "name": "BAbbad-DHCP",
    "ip": "10.192.178.253",
    "type": "unknown",
    "model": "",
    "platform": "MikroTik",
    "capabilities": null,
    "discovered_by": "cdp_discovery",
    "discovered_at": "2025-12-14T16:56:19.420971",
    "last_seen": "2025-12-15T12:24:20.599160",
    "last_modified": "2025-12-14T16:56:19.420999",
    "status": "online",
    "reachable": true,
    "config_backup": {
      "enabled": false
    },
    "connections": [],
    "credentials_used": "kordestani",
    "modules_successful": [
      "cdp_discovery"
    ],
    "modules_failed": [],
    "locked": false,
    "notes": "Discovered via CDP from 10.192.178.2"
  },
  {
    "id": "dev_5f5a1277",
    "site": "Roodan",
    "name": "sw3-Dry-Buffer.OKCO.ir",
    "ip": "10.192.178.3",
    "type": "unknown",
    "model": "",
    "platform": "cisco WS-C2960S-48FPS-L",
    "capabilities": null,
    "discovered_by": "cdp_discovery",
    "discovered_at": "2025-12-14T16:56:19.421796",
    "last_seen": "2025-12-15T12:24:20.599192",
    "last_modified": "2025-12-14T16:56:19.421822",
    "status": "online",
    "reachable": true,
    "config_backup": {
      "enabled": false
    },
    "connections": [
      {
        "id": "conn_6e73cfa8",
        "local_interface": "GigabitEthernet1/0/48",
        "remote_device": "dev_5beecadf",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-15T12:24:54.216683",
        "status": "up"
      },
      {
        "id": "conn_2b705e7c",
        "local_interface": "GigabitEthernet1/0/47",
        "remote_device": "dev_ca88c00d",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-15T12:24:54.216765",
        "status": "up"
      }
    ],
    "credentials_used": "kordestani",
    "modules_successful": [
      "cdp_discovery"
    ],
    "modules_failed": [],
    "locked": false,
    "notes": "Discovered via CDP from 10.192.178.2"
  },
  {
    "id": "dev_b1d768a2",
    "site": "Roodan",
    "name": "SXT-Babbas2",
    "ip": "10.192.178.145",
    "type": "other",
    "model": "",
    "platform": "MikroTik",
    "capabilities": null,
    "discovered_by": "cdp_discovery",
    "discovered_at": "2025-12-14T17:05:24.402404",
    "last_seen": "2025-12-15T12:24:35.846774",
    "last_modified": "2025-12-16T12:40:12.881440",
    "status": "online",
    "reachable": true,
    "config_backup": {
      "enabled": false
    },
    "connections": [],
    "credentials_used": "kordestani",
    "modules_successful": [
      "cdp_discovery"
    ],
    "modules_failed": [],
    "locked": false,
    "notes": "Discovered via CDP from 10.192.178.4"
  },
  {
    "id": "dev_1b4e5150",
    "site": "Roodan",
    "name": "SXT-Babbas1",
    "ip": "10.192.178.144",
    "type": "unknown",
    "model": "",
    "platform": "MikroTik",
    "capabilities": null,
    "discovered_by": "cdp_discovery",
    "discovered_at": "2025-12-14T17:05:24.402538",
    "last_seen": "2025-12-15T12:24:35.847013",
    "last_modified": "2025-12-14T17:05:24.402548",
    "status": "online",
    "reachable": true,
    "config_backup": {
      "enabled": false
    },
    "connections": [],
    "credentials_used": "kordestani",
    "modules_successful": [
      "cdp_discovery"
    ],
    "modules_failed": [],
    "locked": false,
    "notes": "Discovered via CDP from 10.192.178.4"
  },
  {
    "id": "dev_ca88c00d",
    "site": "Roodan",
    "name": "Sw5-Dry-akhar.OKCO.ir",
    "ip": "10.192.178.5",
    "type": "unknown",
    "model": "",
    "platform": "cisco WS-C2960S-48FPS-L",
    "capabilities": null,
    "discovered_by": "cdp_discovery",
    "discovered_at": "2025-12-15T12:24:54.216746",
    "last_seen": "2025-12-15T12:24:54.216749",
    "last_modified": "2025-12-15T12:24:54.216750",
    "status": "online",
    "reachable": true,
    "config_backup": {
      "enabled": false
    },
    "connections": [
      {
        "id": "conn_e068c696",
        "local_interface": "GigabitEthernet1/0/48",
        "remote_device": "dev_5f5a1277",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-15T12:25:39.878649",
        "status": "up"
      },
      {
        "id": "conn_60ade13b",
        "local_interface": "GigabitEthernet1/0/47",
        "remote_device": "dev_89233579",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-15T12:25:39.878732",
        "status": "up"
      }
    ],
    "credentials_used": "kordestani",
    "modules_successful": [
      "cdp_discovery"
    ],
    "modules_failed": [],
    "locked": false,
    "notes": "Discovered via CDP from 10.192.178.3"
  },
  {
    "id": "dev_89233579",
    "site": "Roodan",
    "name": "SW6-Cold-Akhar.OKCO.ir",
    "ip": "10.192.178.6",
    "type": "unknown",
    "model": "",
    "platform": "cisco WS-C2960S-48FPS-L",
    "capabilities": null,
    "discovered_by": "cdp_discovery",
    "discovered_at": "2025-12-15T12:25:39.878714",
    "last_seen": "2025-12-15T12:25:39.878717",
    "last_modified": "2025-12-15T12:25:39.878719",
    "status": "online",
    "reachable": true,
    "config_backup": {
      "enabled": false
    },
    "connections": [
      {
        "id": "conn_ce0055e4",
        "local_interface": "GigabitEthernet2/0/48",
        "remote_device": "dev_ca88c00d",
        "remote_interface": null,
        "protocol": "cdp",
        "discovered_at": "2025-12-15T12:25:45.208709",
        "status": "up"
      }
    ],
    "credentials_used": "kordestani",
    "modules_successful": [
      "cdp_discovery"
    ],
    "modules_failed": [],
    "locked": false,
    "notes": "Discovered via CDP from 10.192.178.5"
  }
];
        const connections = [
  {
    "source": "dev_5beecadf",
    "target": "dev_cc3a85f4",
    "local_port": "GigabitEthernet1/0/42",
    "protocol": "cdp"
  },
  {
    "source": "dev_5beecadf",
    "target": "dev_683fb499",
    "local_port": "GigabitEthernet1/0/40",
    "protocol": "cdp"
  },
  {
    "source": "dev_5beecadf",
    "target": "dev_385652c8",
    "local_port": "GigabitEthernet1/0/47",
    "protocol": "cdp"
  },
  {
    "source": "dev_5beecadf",
    "target": "dev_5f5a1277",
    "local_port": "GigabitEthernet1/0/39",
    "protocol": "cdp"
  },
  {
    "source": "dev_683fb499",
    "target": "dev_b1d768a2",
    "local_port": "GigabitEthernet1/0/46",
    "protocol": "cdp"
  },
  {
    "source": "dev_683fb499",
    "target": "dev_1b4e5150",
    "local_port": "GigabitEthernet1/0/46",
    "protocol": "cdp"
  },
  {
    "source": "dev_5f5a1277",
    "target": "dev_ca88c00d",
    "local_port": "GigabitEthernet1/0/47",
    "protocol": "cdp"
  },
  {
    "source": "dev_ca88c00d",
    "target": "dev_89233579",
    "local_port": "GigabitEthernet1/0/47",
    "protocol": "cdp"
  }
];
        
        // Device mapping
        const deviceMap = {};
        devices.forEach(device => {
            deviceMap[device.id] = device;
        });
        
        // Get device color
        function getDeviceColor(device) {
            const platform = (device.platform || '').toLowerCase();
            if (platform.includes('cisco')) {
                return platform.includes('2911') || platform.includes('router') ? '#2196F3' : '#D71920';
            } else if (platform.includes('mikrotik')) {
                return '#FF9800';
            }
            return '#94a3b8';
        }
        
        // Get device status color
        function getStatusColor(device) {
            return device.status === 'online' ? '#10B981' : '#EF4444';
        }
        
        // Initialize visualization
        function initVisualization() {
            const width = document.querySelector('.visualization').clientWidth;
            const height = document.querySelector('.visualization').clientHeight;
            
            const svg = d3.select('#network-graph')
                .attr('width', width)
                .attr('height', height);
            
            // Clear previous
            svg.selectAll('*').remove();
            
            // Create main group
            const g = svg.append('g');
            
            // Zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });
            
            svg.call(zoom);
            
            // Create force simulation
            const simulation = d3.forceSimulation(devices)
                .force('link', d3.forceLink(connections)
                    .id(d => d.id)
                    .distance(150))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(40));
            
            // Create links
            const link = g.append('g')
                .selectAll('line')
                .data(connections)
                .enter().append('g');
            
            link.append('line')
                .attr('class', 'link')
                .attr('stroke', '#1e293b')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', d => d.protocol === 'cdp' ? '5,5' : 'none');
            
            // Add connection labels
            link.append('text')
                .attr('class', 'connection-label')
                .text(d => {
                    const sourceDevice = deviceMap[d.source];
                    const conn = sourceDevice?.connections?.find(c => c.remote_device === d.target);
                    return conn ? conn.local_interface.split('/').pop() || 'port' : '';
                });
            
            // Create nodes
            const node = g.append('g')
                .selectAll('g')
                .data(devices)
                .enter().append('g')
                .attr('class', 'node')
                .call(d3.drag()
                    .on('start', dragStarted)
                    .on('drag', dragged)
                    .on('end', dragEnded))
                .on('mouseover', showTooltip)
                .on('mouseout', hideTooltip)
                .on('click', highlightDevice);
            
            // Node circles
            node.append('circle')
                .attr('r', 30)
                .attr('fill', d => getDeviceColor(d))
                .attr('stroke', d => getStatusColor(d))
                .attr('stroke-width', 3);
            
            // Device name (shortened)
            node.append('text')
                .attr('text-anchor', 'middle')
                .attr('dy', 4)
                .attr('fill', 'white')
                .attr('font-size', '10px')
                .attr('font-weight', 'bold')
                .text(d => {
                    const name = d.name || 'Unknown';
                    return name.length > 12 ? name.substring(0, 10) + '...' : name;
                });
            
            // Status indicator
            node.append('circle')
                .attr('r', 6)
                .attr('cx', 20)
                .attr('cy', -20)
                .attr('fill', d => getStatusColor(d))
                .attr('stroke', '#020617')
                .attr('stroke-width', 2);
            
            // Update positions on tick
            simulation.on('tick', () => {
                link.select('line')
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                
                link.select('text')
                    .attr('x', d => (d.source.x + d.target.x) / 2)
                    .attr('y', d => (d.source.y + d.target.y) / 2 - 10);
                
                node.attr('transform', d => `translate(${d.x}, ${d.y})`);
            });
            
            // Drag functions
            function dragStarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }
            
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            
            function dragEnded(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
            
            // Tooltip functions
            function showTooltip(event, d) {
                const tooltip = document.getElementById('node-tooltip');
                const connections = d.connections || [];
                
                let html = `<div class="tooltip-title">${d.name}</div>`;
                html += `<div class="tooltip-detail">IP: <code>${d.ip}</code></div>`;
                html += `<div class="tooltip-detail">Platform: ${d.platform || 'Unknown'}</div>`;
                html += `<div class="tooltip-detail">Status: <span style="color:${getStatusColor(d)}">${d.status || 'unknown'}</span></div>`;
                
                if (connections.length > 0) {
                    html += `<div class="tooltip-detail" style="margin-top: 8px;"><strong>Connections:</strong></div>`;
                    connections.slice(0, 3).forEach(conn => {
                        const remote = deviceMap[conn.remote_device];
                        if (remote) {
                            html += `<div class="tooltip-detail">• ${conn.local_interface} → ${remote.name}</div>`;
                        }
                    });
                    if (connections.length > 3) {
                        html += `<div class="tooltip-detail">... and ${connections.length - 3} more</div>`;
                    }
                }
                
                tooltip.innerHTML = html;
                tooltip.style.display = 'block';
                tooltip.style.left = (event.pageX + 10) + 'px';
                tooltip.style.top = (event.pageY + 10) + 'px';
            }
            
            function hideTooltip() {
                document.getElementById('node-tooltip').style.display = 'none';
            }
            
            // Highlight device
            function highlightDevice(event, d) {
                // Highlight node
                node.select('circle').attr('stroke-width', 3);
                d3.select(event.currentTarget).select('circle').attr('stroke-width', 6);
                
                // Highlight connected links
                link.select('line').attr('stroke', '#1e293b').attr('stroke-width', 2);
                connections.forEach(conn => {
                    if (conn.source.id === d.id || conn.target.id === d.id) {
                        d3.selectAll(`line[data-source="${conn.source.id}"][data-target="${conn.target.id}"]`)
                            .attr('stroke', '#D71920')
                            .attr('stroke-width', 3);
                    }
                });
                
                // Update sidebar
                document.querySelectorAll('.device-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.deviceId === d.id) {
                        item.classList.add('active');
                        item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            }
            
            // Populate sidebar
            populateSidebar();
            
            // Initial fit to screen
            setTimeout(fitToScreen, 100);
        }
        
        // Populate sidebar device list
        function populateSidebar() {
            const deviceList = document.getElementById('device-list');
            deviceList.innerHTML = '';
            
            devices.forEach(device => {
                const div = document.createElement('div');
                div.className = 'device-item';
                div.dataset.deviceId = device.id;
                
                div.innerHTML = `
                    <div class="device-name">${device.name}</div>
                    <div class="device-ip">${device.ip}</div>
                    <div class="device-status ${device.status === 'online' ? 'status-online' : 'status-unreachable'}">
                        ${device.status || 'unknown'}
                    </div>
                `;
                
                div.addEventListener('click', () => {
                    // Find and highlight the corresponding node
                    const nodes = d3.selectAll('.node').nodes();
                    const nodeIndex = devices.findIndex(d => d.id === device.id);
                    if (nodeIndex !== -1 && nodes[nodeIndex]) {
                        nodes[nodeIndex].dispatchEvent(new MouseEvent('click'));
                    }
                });
                
                deviceList.appendChild(div);
            });
        }
        
        // Control functions
        function zoomIn() {
            d3.select('#network-graph').transition().call(
                d3.zoom().scaleBy, 1.2
            );
        }
        
        function zoomOut() {
            d3.select('#network-graph').transition().call(
                d3.zoom().scaleBy, 0.8
            );
        }
        
        function resetView() {
            d3.select('#network-graph').transition().call(
                d3.zoom().transform,
                d3.zoomIdentity
            );
        }
        
        function fitToScreen() {
            const svg = document.getElementById('network-graph');
            const width = svg.clientWidth;
            const height = svg.clientHeight;
            
            // Get bounds of all nodes
            let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
            devices.forEach(node => {
                if (node.x) {
                    minX = Math.min(minX, node.x - 40);
                    maxX = Math.max(maxX, node.x + 40);
                    minY = Math.min(minY, node.y - 40);
                    maxY = Math.max(maxY, node.y + 40);
                }
            });
            
            const scale = Math.min(
                0.8 * width / (maxX - minX),
                0.8 * height / (maxY - minY)
            );
            
            const transform = d3.zoomIdentity
                .translate(width / 2, height / 2)
                .scale(scale)
                .translate(-(minX + maxX) / 2, -(minY + maxY) / 2);
            
            d3.select('#network-graph').transition().duration(750).call(
                d3.zoom().transform,
                transform
            );
        }
        
        // Handle window resize
        window.addEventListener('resize', initVisualization);
        
        // Initialize
        document.addEventListener('DOMContentLoaded', initVisualization);
    </script>
    
    <div style="position: fixed; bottom: 10px; left: 10px; font-size: 10px; color: #64748b; z-index: 1000;">
        Generated: 2025-12-16 16:12:23
    </div>
</body>
</html>

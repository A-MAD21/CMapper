<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Discovery Platform</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%230c1b2a'/%3E%3Cpath d='M18 44l10-22 8 10 10-12' stroke='%231f8ef1' stroke-width='6' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Ccircle cx='18' cy='44' r='4' fill='%23c1ddff'/%3E%3Ccircle cx='28' cy='22' r='4' fill='%23c1ddff'/%3E%3Ccircle cx='36' cy='32' r='4' fill='%23c1ddff'/%3E%3Ccircle cx='46' cy='20' r='4' fill='%23c1ddff'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .auth-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(6, 10, 14, 0.75);
            backdrop-filter: blur(4px);
            z-index: 9999;
        }
        .auth-card {
            width: min(420px, 92vw);
            background: #ffffff;
            border: 1px solid #d9e2ef;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 18px 60px rgba(15, 23, 32, 0.18);
        }
        .auth-card h2 {
            margin-bottom: 8px;
            color: #1c2b3a;
        }
        .auth-card p {
            color: #5b6b7b;
            margin-bottom: 16px;
        }
        .auth-card .form-group {
            margin-bottom: 12px;
        }
        .auth-card label {
            color: #1c2b3a;
        }
        .auth-card input {
            background: #ffffff;
            color: #1c2b3a;
            border: 1px solid #d9e2ef;
        }
        .multi-select {
            position: relative;
        }
        .multi-select-toggle {
            width: 100%;
            display: flex;
            justify-content: space-between;
            gap: 8px;
            background: #ffffff;
            color: #1c2b3a;
            border: 1px solid #d9e2ef;
        }
        .multi-select-panel {
            position: absolute;
            top: calc(100% + 6px);
            left: 0;
            right: 0;
            background: #ffffff;
            border: 1px solid #d9e2ef;
            border-radius: 10px;
            padding: 10px;
            max-height: 220px;
            overflow: auto;
            display: none;
            z-index: 50;
            color: #1c2b3a;
            box-shadow: 0 10px 30px rgba(15, 23, 32, 0.12);
        }
        .multi-select.open .multi-select-panel {
            display: block;
        }
        .multi-select-option {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            font-size: 0.92em;
            color: #1c2b3a;
        }
        .multi-select-option input[type="checkbox"] {
            accent-color: #1f8ef1;
        }
    </style>
    <script src="/static/js/feather-local.js"></script>
</head>
<body>
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-card">
            <h2>Sign in</h2>
            <p>Enter your username and password to continue.</p>
            <div class="form-group">
                <label for="loginUsername">Username</label>
                <input type="text" id="loginUsername" autocomplete="username">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" autocomplete="current-password">
            </div>
            <div class="form-group" style="display: flex; gap: 12px; align-items: center;">
                <button class="btn btn-primary" id="loginBtn">Sign In</button>
                <span id="loginMessage" style="font-size: 0.9em; color: var(--text-secondary);"></span>
            </div>
        </div>
    </div>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i data-feather="globe"></i>
                    <span>NetDiscover</span>
                </div>
                <div class="current-site" id="currentSiteDisplay">No site selected</div>
            </div>
            
            <nav class="sidebar-nav">
                <ul>
                    <li class="nav-item active" data-tab="dashboard">
                        <i data-feather="home"></i>
                        <span>Dashboard</span>
                    </li>
                    <li class="nav-item" data-tab="sites">
                        <i data-feather="map-pin"></i>
                        <span>Sites</span>
                    </li>
                                        <li class="nav-item" data-tab="devices">
                        <i data-feather="server"></i>
                        <span>Devices</span>
                    </li>
                    <li class="nav-item" data-tab="topology">
                        <i data-feather="share-2"></i>
                        <span>Topology</span>
                    </li>
                    <li class="nav-item" data-tab="map">
                        <i data-feather="map"></i>
                        <span>Map</span>
                    </li>
                    <li class="nav-item" data-tab="monitoring">
                        <i data-feather="activity"></i>
                        <span>Monitoring</span>
                    </li>
                    <li class="nav-item" data-tab="settings">
                        <i data-feather="settings"></i>
                        <span>Settings</span>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <div class="status-indicator">
                    <div class="status-dot active"></div>
                    <span>System Ready</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                    <div class="last-update">Last updated: <span id="lastUpdateTime">--:--:--</span></div>
                </div>
                <div class="header-right">
                    <button class="btn btn-secondary" id="refreshBtn">
                        <i data-feather="refresh-cw"></i>
                        Refresh
                    </button>
                    <button class="btn btn-secondary" id="logoutBtnGlobal">
                        <i data-feather="log-out"></i>
                        Log Out
                    </button>
                </div>
            </header>

            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboardTab">
                <div class="stats-grid" id="statsGrid">
                    <!-- Real stats will be loaded here -->
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2>Sites Overview</h2>
                        <button class="btn btn-primary" id="addSiteBtn">
                            <i data-feather="plus"></i>
                            Add Site
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort-target="dashboardSites" data-sort-key="name">Site Name</th>
                                    <th class="sortable" data-sort-target="dashboardSites" data-sort-key="root_ip">Root IP</th>
                                    <th class="sortable" data-sort-target="dashboardSites" data-sort-key="devices">Devices</th>
                                    <th class="sortable" data-sort-target="dashboardSites" data-sort-key="last_scan">Last Scan</th>
                                    <th class="sortable" data-sort-target="dashboardSites" data-sort-key="status">Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sitesTableBody">
                                <!-- Real sites will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Sites Tab -->
            <div class="tab-content" id="sitesTab">
                <div class="card">
                    <div class="card-header">
                        <h2>Manage Sites</h2>
                        <button class="btn btn-primary" id="addSiteBtn2">
                            <i data-feather="plus"></i>
                            Add New Site
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort-target="sites" data-sort-key="name">Site Name</th>
                                    <th class="sortable" data-sort-target="sites" data-sort-key="root_ip">Root IP</th>
                                    <th class="sortable" data-sort-target="sites" data-sort-key="created">Created</th>
                                    <th class="sortable" data-sort-target="sites" data-sort-key="devices">Devices</th>
                                    <th class="sortable" data-sort-target="sites" data-sort-key="last_scan">Last Scan</th>
                                    <th class="sortable" data-sort-target="sites" data-sort-key="locked">Locked</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sitesManagementBody">
                                <!-- Real sites will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Devices Tab -->
            <div class="tab-content" id="devicesTab">
                <div class="card">
                    <div class="card-header">
                        <h2>Devices</h2>
                        <div class="header-actions">
                            <div class="site-selector">
                                <select id="deviceSiteFilter">
                                    <option value="">All Sites</option>
                                </select>
                            </div>
                            <button class="btn btn-secondary" id="deleteSelectedDevicesBtn" disabled>
                                <i data-feather="trash-2"></i>
                                Remove Selected
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 34px;">
                                        <input type="checkbox" id="devicesSelectAll">
                                    </th>
                                    <th class="sortable" data-sort-target="devices" data-sort-key="name">Device Name</th>
                                    <th class="sortable" data-sort-target="devices" data-sort-key="ip">IP Address</th>
                                    <th class="sortable" data-sort-target="devices" data-sort-key="mac">MAC</th>
                                    <th class="sortable" data-sort-target="devices" data-sort-key="site">Site</th>
                                    <th class="sortable" data-sort-target="devices" data-sort-key="type">Type</th>
                                    <th class="sortable" data-sort-target="devices" data-sort-key="status">Status</th>
                                    <th class="sortable" data-sort-target="devices" data-sort-key="discovered_at">Discovered</th>
                                    <th class="sortable" data-sort-target="devices" data-sort-key="last_seen">Last Seen</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="devicesTableBody">
                                <!-- Real devices will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Topology Tab -->
            <div class="tab-content" id="topologyTab">
                <div class="card">
                    <div class="card-header">
                        <h2>Discovery Modules</h2>
                        <div class="header-actions">
                            <div class="site-selector">
                                <select id="moduleSiteSelect">
                                    <option value="">Select Site</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modules-grid" id="modulesGrid">
                        <!-- Real modules will be loaded here -->
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2>Active Module Jobs</h2>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Module</th>
                                    <th>Status</th>
                                    <th>Progress</th>
                                    <th>Started</th>
                                    <th>Duration</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="moduleJobsBody">
                                <!-- Active module jobs will be shown here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
                        <!-- Map Tab -->
            <div class="tab-content" id="mapTab">
                <div class="card">
                    <div class="card-header">
                        <h2>Network Topology Map</h2>
                        <div class="header-actions">
                            <div class="site-selector">
                                <select id="mapSiteSelect">
                                    <option value="">Select Site</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <button class="btn btn-primary" id="showTextMapBtn">
                                    <i data-feather="list"></i> Text Map
                                </button>
                                <button class="btn btn-primary" id="showVisualMapBtn">
                                    <i data-feather="layout"></i> Visual Map
                                </button>
                                <button class="btn btn-success" id="generateMapBtn">
                                    <i data-feather="refresh-cw"></i> Generate Maps
                                </button>
                            </div>
                            <button class="btn btn-primary" id="showMapBtn" disabled>
                                <i data-feather="eye"></i>
                                Show Map
                            </button>
                        </div>
                    </div>
                    <div class="card-header" style="padding-top: 0;">
                        <div class="header-actions" style="width: 100%; display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                            <div style="padding: 8px 12px; border-radius: 999px; border: 1px solid var(--border-color); background: rgba(255,255,255,0.04);">
                                Selected: <span id="mapSelectedLabel">None</span>
                            </div>
                            <button class="btn btn-primary" id="mapAddBtn">
                                <i data-feather="plus"></i>
                                Add Node
                            </button>
                            <button class="btn btn-secondary" id="mapEditBtn" disabled>
                                <i data-feather="edit-2"></i>
                                Edit Node
                            </button>
                            <button class="btn btn-secondary" id="mapRemoveBtn" disabled>
                                <i data-feather="trash-2"></i>
                                Remove Node
                            </button>
                        </div>
                    </div>
                    
                    <div class="map-container" id="mapContainer" style="padding: 24px; display: none;">
                        <div class="map-controls" style="margin-bottom: 16px; display: flex; gap: 12px;">
                            <button class="btn btn-secondary" id="refreshMapBtn">
                                <i data-feather="refresh-cw"></i>
                                Refresh
                            </button>
                            <button class="btn btn-secondary" id="fullscreenBtn">
                                <i data-feather="maximize"></i>
                                Fullscreen
                            </button>
                        </div>
                        
                        <iframe id="mapFrame" 
                                src="" 
                                style="width: 100%; height: 600px; border: 1px solid var(--border-color); border-radius: 12px; display: none;">
                        </iframe>
                        
                        <div id="noMapMessage" class="empty-state" style="text-align: center; padding: 48px 24px;">
                            <i data-feather="map" style="width: 48px; height: 48px; margin-bottom: 16px;"></i>
                            <h3 style="margin-bottom: 8px;">No Map Available</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 16px;">
                                Select a site and click "Show Map" to view the network topology
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settingsTab">
                <div class="card">
                    <div class="card-header">
                        <h2>Settings</h2>
                        <button class="btn btn-primary" id="saveSettingsBtn">
                            <i data-feather="save"></i>
                            Save Settings
                        </button>
                    </div>
                    <div class="settings-form">
                        <div class="form-group">
                            <label for="defaultSite">Default Site</label>
                            <select id="defaultSite">
                                <option value="">No default site</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="backupPath">Backup Path</label>
                            <input type="text" id="backupPath" placeholder="./backups">
                        </div>
                        <div class="form-group">
                            <label for="scanDepth">Default Scan Depth</label>
                            <input type="number" id="scanDepth" min="1" max="10" value="3">
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoRefresh">
                                <span>Auto Refresh</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="refreshInterval">Refresh Interval (seconds)</label>
                            <input type="number" id="refreshInterval" min="5" max="300" value="30">
                        </div>
                        <div class="form-group" style="margin-top: 12px;">
                            <h3>My Password</h3>
                        </div>
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" placeholder="Current password">
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" placeholder="New password">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary" type="button" id="changePasswordBtn">
                                Change Password
                            </button>
                        </div>
                        <div id="adminAuthSection">
                            <div class="form-group" style="margin-top: 12px;">
                                <h3>Admin Login Setup</h3>
                            </div>
                            <div class="form-group">
                                <label for="authUsername">Admin Username</label>
                                <input type="text" id="authUsername" placeholder="admin">
                            </div>
                            <div class="form-group">
                                <label for="authPassword">Admin Password</label>
                                <input type="password" id="authPassword" placeholder="******">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="authEnabled">
                                    <span>Require login</span>
                                </label>
                            </div>
                            <div class="form-group" style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button class="btn btn-primary" type="button" id="saveAuthBtn">
                                    Save Login
                                </button>
                                <button class="btn btn-secondary" type="button" id="logoutBtn">
                                    Log Out
                                </button>
                            </div>
                        </div>
                        <div id="usersSection" style="margin-top: 12px;">
                            <div class="form-group">
                                <h3>User Management</h3>
                            </div>
                            <div class="form-group" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                                <div>
                                    <label for="addUserName">Username</label>
                                    <input type="text" id="addUserName" placeholder="username">
                                </div>
                                <div>
                                    <label for="addUserPassword">Password</label>
                                    <input type="password" id="addUserPassword" placeholder="password">
                                </div>
                                <div>
                                    <label for="addUserRole">Role</label>
                                    <select id="addUserRole">
                                        <option value="admin">admin</option>
                                        <option value="operator">operator</option>
                                        <option value="guest" selected>guest</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="addUserSites">Allowed Sites</label>
                                    <div class="multi-select" id="addUserSites">
                                        <button class="btn btn-secondary multi-select-toggle" type="button">
                                            Select sites
                                            <span>â–¾</span>
                                        </button>
                                        <div class="multi-select-panel"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" type="button" id="addUserBtn">
                                    Add User
                                </button>
                            </div>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Username</th>
                                            <th>Role</th>
                                            <th>Allowed Sites</th>
                                            <th>Disabled</th>
                                            <th>Reset Password</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div id="dataTransferSection" style="margin-top: 12px;">
                            <div class="form-group">
                                <h3>Data Transfer</h3>
                            </div>
                            <div class="form-group" style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                                <button class="btn btn-primary" type="button" id="exportDataBtn">
                                    Export Data
                                </button>
                                <input type="file" id="importDataFile" accept=".zip" style="max-width: 240px;">
                                <button class="btn btn-secondary" type="button" id="importDataBtn">
                                    Import Data
                                </button>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 0.9em;">
                                Export/import includes devices, settings, and monitoring data (ZIP).
                            </p>
                        </div>
                        <div id="ouiRangesSection" style="margin-top: 12px;">
                            <div class="form-group">
                                <h3>OUI Ranges (Global)</h3>
                            </div>
                            <div class="form-group">
                                <label for="ouiRangesText">Ranges</label>
                                <textarea id="ouiRangesText" rows="10" placeholder="AA:BB:CC:00:00:00-AA:BB:CC:FF:FF:FF=Vendor"></textarea>
                            </div>
                            <div class="form-group" style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button class="btn btn-primary" type="button" id="saveOuiRangesBtn">
                                    Save OUI Ranges
                                </button>
                                <button class="btn btn-secondary" type="button" id="reloadOuiRangesBtn">
                                    Reload
                                </button>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 0.9em;">
                                One range per line. Format: START_MAC-END_MAC=Vendor. Example: 00:15:6D:00:00:00-00:15:6D:FF:FF:FF=Ubiquiti
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Monitoring Tab -->
            <div class="tab-content" id="monitoringTab">
                <div class="card">
                    <div class="card-header">
                        <h2>Monitoring Status</h2>
                        <div class="header-actions">
                            <div class="site-selector">
                                <select id="monitoringSiteSelect">
                                    <option value="">Select Site</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="showMonitoringBtn" disabled>
                                <i data-feather="eye"></i>
                                Show Status
                            </button>
                            <button class="btn btn-secondary" id="monitoringRulesBtn">
                                <i data-feather="sliders"></i>
                                Rules (Not OK)
                            </button>
                        </div>
                    </div>
                    <div class="card-header" style="padding-top: 0;">
                        <div class="header-actions" style="width: 100%; display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                            <div style="padding: 8px 12px; border-radius: 999px; border: 1px solid var(--border-color); background: rgba(255,255,255,0.04);">
                                Selected: <span id="monitoringSelectedLabel">None</span>
                            </div>
                            <button class="btn btn-secondary" id="monitoringToggleBtn" disabled>
                                <i data-feather="power"></i>
                                Toggle Monitoring
                            </button>
                        </div>
                    </div>
                    <div class="monitoring-layout">
                        <aside class="monitoring-panel">
                            <div class="panel-title">Devices</div>
                            <div class="monitoring-device-list" id="monitoringDeviceList">
                                <!-- Available devices populate here -->
                            </div>
                            <div class="panel-title" style="margin-top: 16px;">Activity</div>
                            <div class="monitoring-log" id="monitoringLogList">
                                <!-- Activity logs populate here -->
                            </div>
                        </aside>
                        <div class="monitoring-board" id="monitoringBoard">
                            <div class="monitoring-zone monitoring-top" data-dock="top">
                                <div class="monitoring-zone-label" data-zone="top" contenteditable="true">Top</div>
                                <div class="monitoring-zone-content"></div>
                            </div>
                            <div class="monitoring-zone monitoring-left" data-dock="left">
                                <div class="monitoring-zone-label" data-zone="left" contenteditable="true">Left</div>
                                <div class="monitoring-zone-content"></div>
                            </div>
                            <div class="monitoring-lanes">
                                <div class="monitoring-lane"></div>
                                <div class="monitoring-lane"></div>
                                <div class="monitoring-lane"></div>
                            </div>
                            <div class="monitoring-zone monitoring-center" data-dock="center">
                                <div class="monitoring-zone-label" data-zone="center" contenteditable="true">Center</div>
                                <div class="monitoring-zone-content"></div>
                            </div>
                            <div class="monitoring-zone monitoring-right" data-dock="right">
                                <div class="monitoring-zone-label" data-zone="right" contenteditable="true">Right</div>
                                <div class="monitoring-zone-content"></div>
                            </div>
                            <div class="monitoring-zone monitoring-bottom" data-dock="bottom">
                                <div class="monitoring-zone-label" data-zone="bottom" contenteditable="true">Bottom</div>
                                <div class="monitoring-zone-content"></div>
                            </div>
                            <div class="monitoring-zone monitoring-trash" data-dock="none">
                                Drop here to remove
                            </div>
                        </div>
                    </div>
                        <div class="empty-state" style="text-align: center; padding: 48px 24px;">
                            <i data-feather="activity" style="width: 48px; height: 48px; margin-bottom: 16px;"></i>
                            <h3 style="margin-bottom: 8px;">No Monitoring Data</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 16px;">
                                Select a site and run the ping monitor module to populate status.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module Runner Modal -->
            <div class="modal" id="moduleRunnerModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="moduleModalTitle">Run Module</h3>
                        <button class="btn-icon close-modal">
                            <i data-feather="x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="moduleFormContainer">
                            <!-- Module form will be generated here -->
                        </div>
                        <div class="module-status" id="moduleStatusDisplay" style="display: none;">
                            <div class="status-message"></div>
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                            <div class="status-details"></div>
                            <div class="module-log" id="moduleLogOutput" style="margin-top: 12px; display: none;">
                                <textarea readonly rows="8" style="width: 100%;"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary close-modal">Cancel</button>
                        <button class="btn btn-primary" id="startModuleBtn">Start Module</button>
                    </div>
                </div>
            </div>

            <!-- Add Site Modal -->
            <div class="modal" id="addSiteModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Add New Site</h3>
                        <button class="btn-icon close-modal">
                            <i data-feather="x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="siteName">Site Name</label>
                            <input type="text" id="siteName" placeholder="e.g., Ahvaz-Warehouse">
                        </div>
                        <div class="form-group">
                            <label for="siteRootIP">Root IP Address</label>
                            <input type="text" id="siteRootIP" placeholder="e.g., 10.192.3.2">
                        </div>
                        <div class="form-group">
                            <label for="siteNotes">Notes (Optional)</label>
                            <textarea id="siteNotes" rows="3" placeholder="Additional information about this site"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary close-modal">Cancel</button>
                        <button class="btn btn-primary" id="saveSiteBtn">Add Site</button>
                    </div>
                </div>
            </div>

            <!-- Edit Device Modal -->
            <div class="modal" id="editDeviceModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Edit Device</h3>
                        <button class="btn-icon close-modal">
                            <i data-feather="x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="editDeviceName">Device Name</label>
                            <input type="text" id="editDeviceName">
                        </div>
                        <div class="form-group">
                            <label for="editDeviceIP">IP Address</label>
                            <input type="text" id="editDeviceIP">
                        </div>
                        <div class="form-group">
                            <label for="editDeviceVlan">VLAN</label>
                            <input type="text" id="editDeviceVlan" placeholder="10">
                        </div>
                        <div class="form-group">
                            <label for="editDeviceMac">MAC Address</label>
                            <input type="text" id="editDeviceMac" placeholder="AA:BB:CC:DD:EE:FF">
                        </div>
                        <div class="form-group">
                            <label for="editDeviceType">Device Type</label>
                            <select id="editDeviceType">
                                <option value="router">Router</option>
                                <option value="switch">Switch</option>
                                <option value="firewall">Firewall</option>
                                <option value="ap">Access Point</option>
                                <option value="nvr">NVR</option>
                                <option value="pda">PDA</option>
                                <option value="server">Server</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editDeviceOS">Operating System</label>
                            <input type="text" id="editDeviceOS" placeholder="IOS-XE, RouterOS, Windows, Linux">
                        </div>
                        <div class="form-group">
                            <label for="editDeviceVendor">Vendor</label>
                            <input type="text" id="editDeviceVendor" placeholder="Cisco, MikroTik, HP">
                        </div>
                        <div class="form-group">
                            <label for="editDevicePlatform">Platform / Model</label>
                            <input type="text" id="editDevicePlatform" placeholder="WS-C2960S-48FPS-L">
                        </div>
                        <div class="form-group">
                            <label for="editDeviceStatus">Status</label>
                            <select id="editDeviceStatus">
                                <option value="online">Online</option>
                                <option value="offline">Offline</option>
                                <option value="unknown">Unknown</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editDeviceNotes">Notes</label>
                            <textarea id="editDeviceNotes" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Connections</label>
                            <div id="editConnectionsWrap"></div>
                            <button class="btn btn-secondary" type="button" id="addConnectionRowBtn">
                                Add Connection
                            </button>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="editCreateMissingNodes" checked>
                                <span>Create missing nodes from connection list</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="editDeviceLocked">
                                <span>Lock device (prevent module updates)</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="editDeviceAlwaysShowMap">
                                <span>Always show on map (even if isolated)</span>
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary close-modal">Cancel</button>
                        <button class="btn btn-primary" id="updateDeviceBtn">Update Device</button>
                    </div>
                </div>
            </div>

            <!-- Edit OUI Modal -->
            <div class="modal" id="editOuiModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Edit OUI Range</h3>
                        <button class="btn-icon close-modal">
                            <i data-feather="x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="ouiDeviceMac">MAC Address</label>
                            <input type="text" id="ouiDeviceMac" readonly>
                        </div>
                        <div class="form-group">
                            <label for="editDeviceOuiLabel">OUI Label</label>
                            <input type="text" id="editDeviceOuiLabel" placeholder="Ubiquiti, MikroTik">
                        </div>
                        <div class="form-group">
                            <label for="editDeviceOuiStart">OUI Range Start</label>
                            <input type="text" id="editDeviceOuiStart" placeholder="AA:BB:CC:00:00:00">
                        </div>
                        <div class="form-group">
                            <label for="editDeviceOuiEnd">OUI Range End</label>
                            <input type="text" id="editDeviceOuiEnd" placeholder="AA:BB:CC:FF:FF:FF">
                        </div>
                        <div class="form-group" style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" type="button" id="fillOuiFromMacBtn">
                                Use MAC OUI
                            </button>
                            <button class="btn btn-secondary" type="button" id="addOuiRangeBtn">
                                Add OUI Range
                            </button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary close-modal">Cancel</button>
                        <button class="btn btn-primary" id="saveOuiBtn">Save OUI</button>
                    </div>
                </div>
            </div>

            <!-- Monitoring Rules Modal -->
            <div class="modal" id="monitoringRulesModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Rules for Not OK</h3>
                        <button class="btn-icon close-modal">
                            <i data-feather="x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="monitorLossThreshold">Packet Loss Threshold (%)</label>
                            <input type="number" id="monitorLossThreshold" min="0" max="100" value="100">
                        </div>
                        <div class="form-group">
                            <label for="monitorLatencyThreshold">Ping Latency Threshold (ms)</label>
                            <input type="number" id="monitorLatencyThreshold" min="1" max="10000" value="500">
                        </div>
                        <p style="color: var(--text-secondary); font-size: 0.9em;">
                            Nodes exceeding packet loss or latency will be marked not OK. More rules can be added later.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary close-modal">Cancel</button>
                        <button class="btn btn-primary" id="saveMonitoringRulesBtn">Save Rules</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/static/js/dashboard.js"></script>
    <script>
        // Initialize Feather icons (guard if CDN is blocked)
        if (window.feather && typeof feather.replace === 'function') {
            feather.replace();
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
        });
    </script>
</body>
</html>
